----

Author: Li Fei

Date: 2019-06-22

Description: EDM 提数平台详细设计

---

##  一、注册EDM平台用户

### 1.1 填写注册信息

注意，密码需要进行加密。

#### 用户表： edmers

| 字段       | 类型         | 属性    | 描述                   |
| ---------- | ------------ | ------- | ---------------------- |
| eid        | int(11)      | Integer | 主键，自增             |
| username   | varchar(100) | String  | 姓名，用户名           |
| password   | varchar(200) | String  | 密码，经过加密         |
| email      | varchar(100) | String  | 邮箱                   |
| department | varchar(200) | String  | 部门                   |
| level      | int(11)      | Integer | 级别，(1 执行；2 监督) |



####角色表：edm_roles

| 字段      | 类型         | 属性    | 描述       |
| --------- | ------------ | ------- | ---------- |
| rid       | int(11)      | Integer | 主键，自增 |
| role_name | varchar(100) | String  | 角色名称   |
| role_desc | varchar(100) | String  | 角色描述   |



#### 用户角色关联关系表：  edmer_role

| 字段 | 类型    | 属性    | 描述           |
| ---- | ------- | ------- | -------------- |
| eid  | int(11) | Integer | 用户edmer 的id |
| rid  | int(11) | Integer | 角色role的id   |

### 1.2 分配权限

1） 一个用户可以有多个权限；



- 设计表结构
- 设计页面
- 功能开发

## 二、提交申请，转给申请组组长，进行初步审核

2.1 保存申请流转单；

2.2 上传附件，保存附件信息；

2.3 修改申请项表中的流转单id；

2.4 给申请组组长发送邮件，并抄送给申请人；

​     注：给申请组组长发邮件(抄送给申请人)。

补充：

- 将审核结果存到表中，一个流转单对应一条审核结果；
- 在查看详情的页面展示审核结果；
- 在提交页面，提供可以选择发送邮件的对象；

2.5 （申请人）查看流转单列表 ，两个切换页，分别为：流转中的列表，流转完成的列表（待开发）；

| 序号 | 流转单名称 | 操作(查看流转单状态) |
| ---- | ---------- | -------------------- |
|      |            |                      |

2.6 在"流转单列表"中点击流转单名称，可以查看详情；

- 在详情页面，可以将流转单下载成excel；
- 还可以流转单附带的附件；

2.7 在"流转单列表"的操作栏，点击当前状态按钮，可以看到完整的进度条；



## 三、申请组初审

3.1 查看流转单列表，三个切换页，分别为：待审批列表，审批通过列表，流转失败列表(待开发)；

| 序号 | 流转单名称 | 操作 |
| ---- | ---------- | ---- |
|      |            |      |

3.2 在"流转单列表"中点击流转单名称，可以查看详情(和2.6功能相同)；

3.3 在"流转单列表"的操作栏，点击"同意"按钮，填写备注，审核通过；

3.4 在"流转单列表"的操作栏，点击"驳回"按钮，填写备注，驳回申请；

3.5 在流转失败列表，点击"查看原因"，能够看到被驳回的原因；

3.6 发邮件：审核通过，邮件发送给能立组，抄送给"申请人"。

> 开启一个线程发邮件，邮件发送成功之后通知客户端，邮件发送成功。
>
> 使用到两个有趣的技术： 线程池、使用STOMP消息(其中的一个功能——在应用的任何地方发送消息，并且是为指定用户发送消息)
>
> 1. 启用STOMP消息功能



## 四、能力组审批

4.1 查看流转单列表，三个切换页，分别为：待审批列表，审批通过列表，流转失败列表(待开发)

注：功能和"三、申请组"类似，需要根据流转单的状态进行一些调整。





## 五、客服组审批

5.1 查看流转单列表，三个切换页，分别为：待审批列表，审批通过列表，流转失败列表(待开发)

注：功能和"三、申请组"类似，需要根据流转单的状态进行一些调整

5.2 将提数申请条件添加到消息队列中（待开发）；

#### 使用AMQP来实现消息功能，选用RabbitMQ作为消息中间件。

> AMQP能够跨语言和平台。考虑到后期获取消息可能切换成Java、Python等其他语言。



## 六、数据组处理

6.1 获取消息队列的内容，依次进行消费处理（待开发）。

6.2 处理完成之后，生成数据编码（待开发）；

6.3 发邮件将数据编码和数据信息发邮件回馈给运营人（待开发）；









## 七、运营组查看数据编码

7.1 在"数据编码"页面，运营组人员可以查看到所有的数据编码（待开发）；

7.2 点击数据编码，可以查看到里面的数据省份分布情况（待开发）；

